@model EvenimentMD.Web.Models.SingUp.UserDataSignUp
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css">

<div class="row justify-content-center align-items-center">
    <div class="container d-flex justify-content-center">
        <form class="login_form" id="loginForm">
            <h2 id="formTitle">Autentificare</h2>
            <div class="flex-column">
                <label>Email </label>
            </div>
            <div class="inputForm">
                <svg height="20" viewBox="0 0 32 32" width="20" xmlns="http://www.w3.org/2000/svg">
                    <g id="Layer_3" data-name="Layer 3">
                        <path d="m30.853 13.87a15 15 0 0 0 -29.729 4.082 15.1 15.1 0 0 0 12.876 12.918 15.6 15.6 0 0 0 2.016.13 14.85 14.85 0 0 0 7.715-2.145 1 1 0 1 0 -1.031-1.711 13.007 13.007 0 1 1 5.458-6.529 2.149 2.149 0 0 1 -4.158-.759v-10.856a1 1 0 0 0 -2 0v1.726a8 8 0 1 0 .2 10.325 4.135 4.135 0 0 0 7.83.274 15.2 15.2 0 0 0 .823-7.455zm-14.853 8.13a6 6 0 1 1 6-6 6.006 6.006 0 0 1 -6 6z"></path>
                    </g>
                </svg>
                <input type="text" class="input" placeholder="Introdu Email-ul">
            </div>

            <div class="flex-column">
                <label>Password </label>
            </div>
            <div class="inputForm">
                <svg height="20" viewBox="-64 0 512 512" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="m336 512h-288c-26.453125 0-48-21.523438-48-48v-224c0-26.476562 21.546875-48 48-48h288c26.453125 0 48 21.523438 48 48v224c0 26.476562-21.546875 48-48 48zm-288-288c-8.8125 0-16 7.167969-16 16v224c0 8.832031 7.1875 16 16 16h288c8.8125 0 16-7.167969 16-16v-224c0-8.832031-7.1875-16-16-16zm0 0"></path>
                    <path d="m304 224c-8.832031 0-16-7.167969-16-16v-80c0-52.929688-43.070312-96-96-96s-96 43.070312-96 96v80c0 8.832031-7.167969 16-16 16s-16-7.167969-16-16v-80c0-70.59375 57.40625-128 128-128s128 57.40625 128 128v80c0 8.832031-7.167969 16-16 16zm0 0"></path>
                </svg>
                <input type="password" class="input" id="password" placeholder="Introdu Parola">
                <svg id="togglePassword" viewBox="0 0 576 512" height="1em" xmlns="http://www.w3.org/2000/svg" style="cursor: pointer;">
                    <path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM144 256a144 144 0 1 1 288 0 144 144 0 1 1 -288 0zm144-64c0 35.3-28.7 64-64 64c-7.1 0-13.9-1.2-20.3-3.3c-5.5-1.8-11.9 1.6-11.7 7.4c.3 6.9 1.3 13.8 3.2 20.7c13.7 51.2 66.4 81.6 117.6 67.9s81.6-66.4 67.9-117.6c-11.1-41.5-47.8-69.4-88.6-71.1c-5.8-.2-9.2 6.1-7.4 11.7c2.1 6.4 3.3 13.2 3.3 20.3z"></path>
                </svg>
            </div>

            <div class="flex-row">
                <div>
                    <input type="checkbox">
                    <label>Remember me</label>
                </div>
                <span class="span">Ai uitat parola?</span>
            </div>
            <button class="button-submit">Log In</button>
            <p class="p">Nu aveți cont?<span class="span" id="registerLink">Înregistrați-vă!</span></p>
            @Html.Partial("_SocialAuthPartial")
        </form>

        <form class="login_form" id="registerForm" method="post" action="@Url.Action("SignUp", "Auth")" style="display: none;">
            @Html.AntiForgeryToken()
            <h2 id="formTitle">Înregistrare</h2>
            <div class="flex-row">
                <div class="flex-column">
                    <label class="form-label">Nume</label>
                    <div class="inputForm">
                        <input type="text" class="input" name="firstName" placeholder="Introdu Numele">
                    </div>
                </div>

                <div class="flex-column">
                    <label class="form-label">Prenume</label>
                    <div class="inputForm">
                        <input type="text" class="input" name="lastName" placeholder="Introdu Prenumele">
                    </div>
                </div>
            </div>
            <div class="flex-column">
                <label>Email</label>
                <div class="inputForm">
                    <input type="text" class="input" name="email" placeholder="Introdu Email-ul">
                </div>
            </div>
            <div class="flex-column">
                <label>Număr de telefon</label>
                <div class="inputForm">
                    <input type="tel" id="phone" class="input" name="phoneNumber" placeholder="Introdu Numărul de telefon">
                </div>
            </div>
            <div class="flex-column">
                <label>Parola</label>
                <div class="inputForm">
                    <input type="password" class="input" name="password" placeholder="Introdu Parola">
                </div>
            </div>
            <div class="flex-column">
                <label>Confirmare Parola</label>
                <div class="inputForm">
                    <input type="password" class="input" placeholder="Confirmă Parola">
                </div>
            </div>
            <div class="flex-column">
                <label>Rol</label>
                <div class="inputForm">
                    <select class="input" name="userRole">
                        <option value="100">Prestator de servicii</option>
                        <option value="200">Organizator de evenimente</option>
                    </select>
                </div>
            </div>
            <button class="button-submit">Înregistrare</button>
            <p class="p">Ai deja un cont?<span class="span" id="loginLink">Autentifică-te!</span></p>
            @Html.Partial("_SocialAuthPartial")
        </form>
    </div>

    <!-- Alertă de succes -->
    <div id="successAlert" class="alert-container success" style="display: none;">
        <div class="alert-container-icon bg-success d-flex align-items-center justify-content-center">
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="white" class="bi bi-check-lg" viewBox="0 0 16 16">
                <path d="M13.485 1.89a.5.5 0 0 1 .675.738l-8 8.5a.5.5 0 0 1-.722.003l-4-4.5a.5.5 0 1 1 .744-.668L6 10.007l7.485-8.117z" />
            </svg>
        </div>
        <p id="successMessage">Înregistrarea a fost cu succes!</p>
        <button class="alert-button bg-success" onclick="hideAlert('successAlert')">OK</button>
    </div>

    <!-- Containerul pentru alertă de eroare -->
    <div id="errorAlert" class="alert-container error" style="display: none;">
        <div class="alert-container-icon bg-danger d-flex align-items-center justify-content-center">
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="white" class="bi bi-x-lg" viewBox="0 0 16 16">
                <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z" />
            </svg>
        </div>
        <h2 id="errorTitle">Înregistrarea a eșuat</h2>
        <p id="errorMessage">Vă rugăm să încercați din nou.</p>
        <button class="alert-button bg-danger" onclick="hideAlert('errorAlert')">OK</button>
    </div>


</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.5/dist/jquery.validate.min.js"></script>
<script>
    $(function () {

        // Validare formular de înregistrare
        $("#registerForm").validate({
            rules: {
                firstName: {
                    required: true,
                    minlength: 3
                },
                lastName: {
                    required: true,
                    minlength: 3
                },
                email: {
                    required: true,
                    email: true
                },
                phoneNumber: {
                    required: true,
                    digits: true,
                    minlength: 7
                },
                password: {
                    required: true,
                    minlength: 6
                },
                confirmPassword: {
                    required: true,
                    equalTo: "input[name='password']"
                },
                userRole: {
                    required: true
                }
            },
            errorPlacement: function (error, element) {
                $(element)
                    .closest(".inputForm")
                    .append(error);
            },
            errorElement: "span",
            errorClass: "text-danger"
        });
    });
</script>

<script>
    // Variabilă globală pentru stocarea datelor formularului
    var formData = {};

    // Funcție pentru a salva datele formularului
    function saveFormData() {
        formData = {
            firstName: document.querySelector('input[name="firstName"]').value,
            lastName: document.querySelector('input[name="lastName"]').value,
            email: document.querySelector('input[name="email"]').value,
            phoneNumber: document.querySelector('input[name="phoneNumber"]').value,
            password: document.querySelector('input[name="password"]').value,
            userRole: document.querySelector('select[name="userRole"]').value
        };
    }

    // Funcție pentru a restaura datele formularului
    function restoreFormData() {
        if (formData.firstName) document.querySelector('input[name="firstName"]').value = formData.firstName;
        if (formData.lastName) document.querySelector('input[name="lastName"]').value = formData.lastName;
        if (formData.email) document.querySelector('input[name="email"]').value = formData.email;
        if (formData.phoneNumber) document.querySelector('input[name="phoneNumber"]').value = formData.phoneNumber;
        if (formData.password) document.querySelector('input[name="password"]').value = formData.password;
        if (formData.userRole) document.querySelector('select[name="userRole"]').value = formData.userRole;
    }

    // Funcție pentru a marca câmpul cu eroare
    function markFieldWithError(fieldName) {
        var field = document.querySelector(`input[name="${fieldName}"]`);
        if (field) {
            field.classList.add('input-error');
            // Focus pe câmpul cu eroare
            setTimeout(function() {
                field.focus();
            }, 100);
        }
    }

    function hideAlert(alertId) {
        var alert = document.getElementById(alertId);
        alert.classList.remove('show');
        alert.style.display = 'none';

        // Arată formularul înapoi
        if (alertId === 'successAlert') {
            // Dacă e succes, arată formularul de login
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('registerForm').style.display = 'none';
        } else {
            // Dacă e eroare, arată înapoi formularul de înregistrare
            document.getElementById('registerForm').style.display = 'block';
            // Restaurează datele formularului
            restoreFormData();
        }

        // Elimină overlay-ul
        var overlay = document.getElementById('overlay');
        if (overlay) {
            document.body.removeChild(overlay);
        }
    }

    function showOverlay() {
        // Verifică dacă overlay-ul există deja
        if (!document.getElementById('overlay')) {
            var overlay = document.createElement('div');
            overlay.className = 'overlay';
            overlay.id = 'overlay';
            document.body.appendChild(overlay);
        }
    }

    // Interceptează trimiterea formularului pentru a salva datele
    document.getElementById('registerForm').addEventListener('submit', function() {
        saveFormData();
    });

    document.addEventListener('DOMContentLoaded', function() {
        // Inițializează evenimentele pentru comutarea între formulare
        document.getElementById('registerLink').addEventListener('click', function() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
        });

        document.getElementById('loginLink').addEventListener('click', function() {
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('loginForm').style.display = 'block';
        });

        // Verifică dacă există mesaje
        @if (TempData["SuccessMessage"] != null)
        {
            <text>
            showOverlay();
            var successAlert = document.getElementById('successAlert');
            var successMessage = document.getElementById('successMessage');
            successMessage.innerHTML = '@Html.Raw(TempData["SuccessMessage"])';

            // Ascunde formularele
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'none';

            successAlert.style.display = 'block';
            successAlert.classList.add('show');
            </text>
        }

        @if (TempData["ErrorMessage"] != null)
        {
            <text>
            // Salvează datele formularului dacă există model
            @if (Model != null)
            {
                <text>
                formData = {
                    firstName: '@Model.firstName',
                    lastName: '@Model.lastName',
                    email: '@Model.email',
                    phoneNumber: '@Model.phoneNumber',
                    password: '@Model.password',
                    userRole: '@Model.userRole'
                };
                </text>
            }

            showOverlay();
            var errorAlert = document.getElementById('errorAlert');
            var errorTitle = document.getElementById('errorTitle');
            var errorMessage = document.getElementById('errorMessage');

            // Setează titlul standard
            errorTitle.textContent = 'Înregistrarea a eșuat';

            // Setează mesajul specific
            errorMessage.innerHTML = '@Html.Raw(TempData["ErrorMessage"])';

            // Ascunde formularele
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'none';

            errorAlert.style.display = 'block';
            errorAlert.classList.add('show');

            </text>
        }
    });
</script>